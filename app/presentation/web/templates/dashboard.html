{% extends "base.html" %}
{% block title %}Кабинет — ML Translate{% endblock %}

{% block content %}
<h1>Кабинет</h1>

<section class="grid-2">
  <div class="card">
    <h3>Баланс</h3>
    <p class="big">{{ balance or 0 }}</p>
    <form method="post" action="/web/topup" class="row" style="margin-top:10px">
      <input type="number" step="1" min="1" name="amount" placeholder="Сумма пополнения" required>
      <button type="submit">Пополнить</button>
    </form>
  </div>

  <div class="card">
    <h3>Перевод</h3>
    <form method="post" action="/web/translate">
      <label>Исходный текст
        <textarea name="text" rows="5" required placeholder="Hello world"></textarea>
      </label>
      <div class="grid-2" style="margin-top:8px">
        <label>Исх. язык (source)
          <input name="source_lang" value="en" required />
        </label>
        <label>Язык назначения (target)
          <input name="target_lang" value="fr" required />
        </label>
      </div>
      <button type="submit" style="margin-top:10px">Перевести</button>
    </form>

    {% if result %}
      <div class="result">
        <h4>Результат</h4>
        <pre>{{ result }}</pre>
      </div>
    {% endif %}
    {% if error %}
      <p class="error" style="margin-top:8px">{{ error }}</p>
    {% endif %}
  </div>
</section>

<section class="card" style="margin-top:18px">
  <h3>История переводов</h3>
  {% if history and history|length %}
    <div class="table-wrap">
      <table class="table small">
        <thead><tr><th>ID</th><th>Дата</th><th>Исходный текст</th><th>Перевод</th><th>Списано</th></tr></thead>
        <tbody>
        {% for item in history %}
          <tr>
            <td>{{ item.id }}</td>
            <td>{{ item.timestamp }}</td>
            <td>{{ item.input_text }}</td>
            <td>{{ item.output_text }}</td>
            <td>{{ item.cost if item.cost is not none else '—' }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">Пока пусто.</p>
  {% endif %}
</section>

<section class="card" style="margin-top:18px">
  <h3>История операций</h3>
  {% if txns and txns|length %}
    <div class="table-wrap">
      <table class="table small">
        <thead><tr><th>#</th><th>Время</th><th>Тип</th><th>Сумма</th></tr></thead>
        <tbody>
        {% for t in txns[:10] %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ t.timestamp }}</td>
            <td>
              {% set ttype = (t.type|string)|lower %}
              {% if 'пополнение' in ttype %}<span class="badge success">Пополнение</span>
              {% elif 'списание' in ttype %}<span class="badge warn">Списание</span>
              {% else %}{{ t.type }}{% endif %}
            </td>
            <td>{{ t.amount }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    <p style="margin-top:10px"><a class="btn" href="/web/transactions">Смотреть все →</a></p>
  {% else %}
    <p class="muted">Нет операций.</p>
  {% endif %}
</section>
{% endblock %}
